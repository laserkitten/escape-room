<html>
  <head>
    <title>Sliding Puzzle</title>
  	 <link href="css/puzzle.css" rel="stylesheet" type="text/css">
  </head>
  <script>
    var zero = [-1,1,2,3,4,5,6,7,8];
    var list = [-1,1,2,3,4,5,6,7,8];
    var started = false;
    function initialize() {
      const url_params = new URLSearchParams(window.location.search);
      if (url_params.has('file')) {
        var pic = url_params.get('file');}
      else {
        var pic = 'default.jpg';}
      var i;
      for (i=0; i<9; i++) {
        var str = (Math.floor(i/3)).toString() + (i%3).toString();
        document.getElementById(i).innerHTML = "<img src='img/" + pic + "' class='i" + str + "'>";
        document.getElementById(i).className = "p" + str;}
      document.getElementById(list.indexOf(-1)).style.opacity = 0;
      for (i=0; i<99; i++) {
        slide(Math.floor(9*Math.random()));}
      started = true;}
    function slide(tile) {
      var i = list.indexOf(tile);
      var j = list.indexOf(-1);
      var k = i%3;
      var l = j%3;
      var m = Math.floor(i/3);
      var n = Math.floor(j/3);
      var distance = (k-l)*(k-l) + (m-n)*(m-n);
      if (distance == 1) {
        list[i] = -1;
        list[j] = tile;}
      update();}
    function update() {
      if (list[0] != -1) document.getElementById(list[0]).className = 'p00';
      if (list[1] != -1) document.getElementById(list[1]).className = 'p01';
      if (list[2] != -1) document.getElementById(list[2]).className = 'p02';
      if (list[3] != -1) document.getElementById(list[3]).className = 'p10';
      if (list[4] != -1) document.getElementById(list[4]).className = 'p11';
      if (list[5] != -1) document.getElementById(list[5]).className = 'p12';
      if (list[6] != -1) document.getElementById(list[6]).className = 'p20';
      if (list[7] != -1) document.getElementById(list[7]).className = 'p21';
      if (list[8] != -1) document.getElementById(list[8]).className = 'p22';
      if (list[0] == zero[0]) {
        if (list[1] == zero[1]) {
          if (list[2] == zero[2]) {
            if (list[3] == zero[3]) {
              if (list[4] == zero[4]) {
                if (list[5] == zero[5]) {
                  if (list[6] == zero[6]) {
                    if (list[7] == zero[7]) {
                      if (started) finalize();}}}}}}}}}
    function finalize() {
      document.getElementById(list.indexOf(-1)).style.opacity = 1;
      var i;
      for (i=0; i<9; i++) {
        document.getElementById(i).onclick = function() {};}}
  </script>
  <body onload='initialize();'>
    <div id='0' onclick='slide(0);'></div>
    <div id='1' onclick='slide(1);'></div>
    <div id='2' onclick='slide(2);'></div>
    <div id='3' onclick='slide(3);'></div>
    <div id='4' onclick='slide(4);'></div>
    <div id='5' onclick='slide(5);'></div>
    <div id='6' onclick='slide(6);'></div>
    <div id='7' onclick='slide(7);'></div>
    <div id='8' onclick='slide(8);'></div>
  </body>
</html>
